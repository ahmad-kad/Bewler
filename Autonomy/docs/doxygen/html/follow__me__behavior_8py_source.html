<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>URC Machiato 2026 Autonomy: code/state_management/autonomy_state_machine/follow_me_behavior.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">URC Machiato 2026 Autonomy
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">ROS2-based autonomous robotics platform for University Rover Challenge 2026</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_8b9f78d8faf6539c7f4c5bf9d19b0e72.html">state_management</a></li><li class="navelem"><a class="el" href="dir_2eb3e9cc5161e933eeb948cf83454d53.html">autonomy_state_machine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">follow_me_behavior.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="follow__me__behavior_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceautonomy__state__machine_1_1follow__me__behavior.html">    1</a></span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral">Follow Me behavior module for ArUco tag following.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">Implements safe following behavior using ArUco tag detection with</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">configurable safety distances and speed limits.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> math</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span> time</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">from</span> typing <span class="keyword">import</span> Optional, Tuple, Dict, Any</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">import</span> structlog</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> rclpy.client <span class="keyword">import</span> Client</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">from</span> rclpy.qos <span class="keyword">import</span> QoSProfile, ReliabilityPolicy, HistoryPolicy</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">from</span> autonomy_interfaces.msg <span class="keyword">import</span> FollowMeStatus</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> autonomy_interfaces.srv <span class="keyword">import</span> DetectAruco, FollowMeControl</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist, Point</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> Header</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="namespaceautonomy__state__machine_1_1follow__me__behavior.html#a8bc3d97d4a82b260d3fa7bb8b753faf3">   21</a></span>&#160;logger = structlog.get_logger(__name__)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html">   24</a></span>&#160;<span class="keyword">class </span><a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html">FollowMeBehavior</a>:</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">    Follow Me behavior using ArUco tag detection.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral">    Provides safe following behavior with configurable safety distances,</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">    speed limits, and obstacle avoidance.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a62fb804843d7fbd4b9580949e918c9e3">   32</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a62fb804843d7fbd4b9580949e918c9e3">__init__</a>(self, node: Node):</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">        Initialize follow me behavior.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">        Args:</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">            node: Parent ROS2 node</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acd0dac2e27b640aad0f43042c64c0745">   39</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acd0dac2e27b640aad0f43042c64c0745">node</a>node = node</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="comment"># Follow me state</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">   42</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following = <span class="keyword">False</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id: Optional[int] = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">   44</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance = 2.0  <span class="comment"># meters</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">   45</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed = 1.0  <span class="comment"># m/s</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">   46</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">operator_id</a>operator_id = <span class="stringliteral">&quot;unknown&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="comment"># Target tracking</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position: Optional[Point] = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">   50</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">target_distance</a>target_distance = 0.0</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">   51</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">target_angle</a>target_angle = 0.0</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6d6e3562bd958d91cb4d901cbfe93043">   52</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6d6e3562bd958d91cb4d901cbfe93043">last_detection_time</a>last_detection_time = 0.0</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">   53</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible = <span class="keyword">False</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment"># Safety parameters</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">   56</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation = <span class="keyword">False</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">   57</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">current_speed</a>current_speed = 0.0</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment"># QoS profile for reliable communication</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aa2676148fe71bcf7112d1f0ed135f245">   60</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aa2676148fe71bcf7112d1f0ed135f245">qos</a>qos = QoSProfile(</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            reliability=ReliabilityPolicy.RELIABLE,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            history=HistoryPolicy.KEEP_LAST,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            depth=10</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        )</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="comment"># Service clients</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        self.aruco_detection_client: Client = node.create_client(</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            DetectAruco, <span class="stringliteral">&quot;/aruco_detection/detect&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        )</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        self.follow_control_client: Client = node.create_client(</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            FollowMeControl, <span class="stringliteral">&quot;/follow_me/control&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        )</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment"># Publishers</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1d95bd2752635a08e34c65bf465a556b">   75</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1d95bd2752635a08e34c65bf465a556b">status_publisher</a>status_publisher = node.create_publisher(</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            FollowMeStatus, <span class="stringliteral">&quot;/follow_me/status&quot;</span>, self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aa2676148fe71bcf7112d1f0ed135f245">qos</a>qos</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        )</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#ab6dc89be5ee4d0f4059d7692c51ce38c">   78</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#ab6dc89be5ee4d0f4059d7692c51ce38c">cmd_vel_publisher</a>cmd_vel_publisher = node.create_publisher(</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            Twist, <span class="stringliteral">&quot;/cmd_vel&quot;</span>, self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aa2676148fe71bcf7112d1f0ed135f245">qos</a>qos</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        )</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment"># Service server for follow me control</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#accfd84ff3ab8db4164126bf100e06116">   83</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#accfd84ff3ab8db4164126bf100e06116">follow_control_service</a>follow_control_service = node.create_service(</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            FollowMeControl, <span class="stringliteral">&quot;/state_machine/follow_me_control&quot;</span>, </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a9de4d5ff3d78f6412ec0bd3dffc072aa">_handle_follow_control</a>_handle_follow_control</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        )</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="comment"># Timer for follow me control loop</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6b8b6616c16faa8cc9579bd01e6d9e7b">   89</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6b8b6616c16faa8cc9579bd01e6d9e7b">control_timer</a>control_timer = node.create_timer(0.1, self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a787bb64f9d81160cca74bff352d6a232">_follow_control_loop</a>_follow_control_loop)  <span class="comment"># 10Hz</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment"># Timer for status publishing</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a871185943027627b25202623b368fba1">   92</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a871185943027627b25202623b368fba1">status_timer</a>status_timer = node.create_timer(0.5, self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6040bca0161bc5e1b9c5597a191778c7">_publish_status</a>_publish_status)  <span class="comment"># 2Hz</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        logger.info(<span class="stringliteral">&quot;Follow me behavior initialized&quot;</span>)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acdd406741d4c6b26282f46a78683533e">   96</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acdd406741d4c6b26282f46a78683533e">start_following</a>(</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        self, </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        target_tag_id: int, </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        safety_distance: float = 2.0,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        max_speed: float = 1.0,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        operator_id: str = <span class="stringliteral">&quot;unknown&quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    ) -&gt; bool:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">        Start following a specific ArUco tag.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">        Args:</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">            target_tag_id: ID of ArUco tag to follow</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">            safety_distance: Safe following distance in meters</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">            max_speed: Maximum following speed in m/s</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">            operator_id: ID of operator requesting follow</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">        Returns:</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral">            True if successfully started following</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        logger.info(</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="stringliteral">&quot;Starting follow me behavior&quot;</span>,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            target_tag_id=target_tag_id,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            safety_distance=safety_distance,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            max_speed=max_speed,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            operator_id=operator_id</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="comment"># Validate parameters</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">if</span> safety_distance &lt; 0.5:</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            logger.warning(<span class="stringliteral">&quot;Safety distance too small, using minimum of 0.5m&quot;</span>)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            safety_distance = 0.5</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> max_speed &gt; 2.0:</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            logger.warning(<span class="stringliteral">&quot;Max speed too high, limiting to 2.0 m/s&quot;</span>)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            max_speed = 2.0</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment"># Update state</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following = <span class="keyword">True</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">  133</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id = target_tag_id</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance = safety_distance</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed = max_speed</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">operator_id</a>operator_id = operator_id</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible = <span class="keyword">False</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation = <span class="keyword">False</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment"># Test ArUco detection</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#abf65a1c807cb9031346cd147c7d17536">_test_aruco_detection</a>_test_aruco_detection():</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            logger.error(<span class="stringliteral">&quot;ArUco detection not available&quot;</span>)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following = <span class="keyword">False</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        logger.info(<span class="stringliteral">&quot;Follow me behavior started successfully&quot;</span>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a8750f2895a93f084bcfe671e73a99438">  149</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a8750f2895a93f084bcfe671e73a99438">stop_following</a>(self) -&gt; None:</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Stop following behavior.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        logger.info(<span class="stringliteral">&quot;Stopping follow me behavior&quot;</span>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment"># Stop robot movement</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a5ab37fe25aaf2209a5bf717b1aa2bc8c">_publish_velocity</a>_publish_velocity(0.0, 0.0, 0.0)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment"># Reset state</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following = <span class="keyword">False</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">  159</a></span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible = <span class="keyword">False</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation = <span class="keyword">False</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        logger.info(<span class="stringliteral">&quot;Follow me behavior stopped&quot;</span>)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">def </span>_follow_control_loop(self) -&gt; None:</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Main follow me control loop.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following <span class="keywordflow">or</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment"># Detect target ArUco tag</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        detection_result = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a34c24361ed5e575c7eb977b4a5a7ac25">_detect_target_tag</a>_detect_target_tag()</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span> detection_result <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="comment"># Target not visible - stop and wait</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible = <span class="keyword">False</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a5ab37fe25aaf2209a5bf717b1aa2bc8c">_publish_velocity</a>_publish_velocity(0.0, 0.0, 0.0)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment"># Update target information</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        target_pos, distance, angle = detection_result</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position = target_pos</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">target_distance</a>target_distance = distance</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">target_angle</a>target_angle = angle</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible = <span class="keyword">True</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6d6e3562bd958d91cb4d901cbfe93043">last_detection_time</a>last_detection_time = time.time()</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment"># Check safety distance</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation = distance &lt; self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation:</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="comment"># Too close - stop immediately</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            logger.warning(<span class="stringliteral">&quot;Safety distance violated - stopping&quot;</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a5ab37fe25aaf2209a5bf717b1aa2bc8c">_publish_velocity</a>_publish_velocity(0.0, 0.0, 0.0)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment"># Calculate desired movement</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        linear_vel, angular_vel = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#afb9d6741e38fce29341193c2a1ca4235">_calculate_movement</a>_calculate_movement(distance, angle)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment"># Apply speed limits</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        linear_vel = max(-self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed, min(self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed, linear_vel))</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        angular_vel = max(-1.0, min(1.0, angular_vel))  <span class="comment"># Limit angular velocity</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment"># Publish velocity command</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a5ab37fe25aaf2209a5bf717b1aa2bc8c">_publish_velocity</a>_publish_velocity(linear_vel, 0.0, angular_vel)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">current_speed</a>current_speed = abs(linear_vel)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">def </span>_detect_target_tag(self) -&gt; Optional[Tuple[Point, float, float]]:</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral">        Detect the target ArUco tag.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="stringliteral">        Returns:</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">            Tuple of (position, distance, angle) if detected, None otherwise</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.aruco_detection_client.wait_for_service(timeout_sec=1.0):</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment"># Create detection request</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        request = DetectAruco.Request()</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        request.target_tag_ids = [self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id]</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        request.detection_timeout = 0.1  <span class="comment"># 100ms timeout</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        request.require_distance_estimate = <span class="keyword">True</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        request.max_detection_distance = 10.0  <span class="comment"># 10m max detection distance</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="comment"># Call detection service</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            future = self.aruco_detection_client.call_async(request)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acd0dac2e27b640aad0f43042c64c0745">node</a>node.get_executor().spin_until_future_complete(future, timeout_sec=0.2)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> future.done():</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            response = future.result()</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> response.success <span class="keywordflow">or</span> <span class="keywordflow">not</span> response.detected_tag_ids:</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="comment"># Find our target tag</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">not</span> <span class="keywordflow">in</span> response.detected_tag_ids:</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="comment"># Get position and distance</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            tag_index = response.detected_tag_ids.index(self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            position = response.tag_positions[tag_index]</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            distance = response.tag_distances[tag_index]</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            angle = response.tag_angles[tag_index]</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">return</span> (position, distance, angle)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            logger.error(<span class="stringliteral">&quot;ArUco detection failed&quot;</span>, error=str(e))</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">def </span>_calculate_movement(self, distance: float, angle: float) -&gt; Tuple[float, float]:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">        Calculate desired movement based on target position.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">        Args:</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">            distance: Distance to target</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">            angle: Angle to target</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">            </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">        Returns:</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">            Tuple of (linear_velocity, angular_velocity)</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment"># Calculate desired distance (safety distance + small buffer)</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        desired_distance = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance + 0.5</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment"># Calculate linear velocity based on distance error</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        distance_error = distance - desired_distance</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        linear_vel = 0.0</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> abs(distance_error) &gt; 0.2:  <span class="comment"># 20cm deadband</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="comment"># Proportional control for distance</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            kp_distance = 0.5</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            linear_vel = kp_distance * distance_error</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            linear_vel = max(-self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed, min(self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed, linear_vel))</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment"># Calculate angular velocity based on angle error</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        angular_vel = 0.0</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> abs(angle) &gt; 0.1:  <span class="comment"># 0.1 rad deadband (~6 degrees)</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="comment"># Proportional control for angle</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            kp_angle = 1.0</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            angular_vel = kp_angle * angle</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            angular_vel = max(-1.0, min(1.0, angular_vel))</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">return</span> linear_vel, angular_vel</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keyword">def </span>_publish_velocity(self, linear_x: float, linear_y: float, angular_z: float) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Publish velocity command.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        twist = Twist()</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        twist.linear.x = linear_x</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        twist.linear.y = linear_y</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        twist.angular.z = angular_z</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#ab6dc89be5ee4d0f4059d7692c51ce38c">cmd_vel_publisher</a>cmd_vel_publisher.publish(twist)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keyword">def </span>_publish_status(self) -&gt; None:</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Publish follow me status.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        msg = FollowMeStatus()</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        msg.header = Header()</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        msg.header.stamp = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acd0dac2e27b640aad0f43042c64c0745">node</a>node.get_clock().now().to_msg()</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        msg.header.frame_id = <span class="stringliteral">&quot;base_link&quot;</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        msg.is_following = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        msg.target_tag_id = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">else</span> 0</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        msg.target_distance = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">target_distance</a>target_distance</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        msg.target_angle = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">target_angle</a>target_angle</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        msg.safety_distance = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        msg.safety_violation = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        msg.current_speed = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">current_speed</a>current_speed</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position:</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            msg.target_position = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        msg.target_visible = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        msg.last_detection_time = time.time() - self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6d6e3562bd958d91cb4d901cbfe93043">last_detection_time</a>last_detection_time</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        msg.max_speed = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">max_speed</a>max_speed</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        msg.operator_id = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">operator_id</a>operator_id</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1d95bd2752635a08e34c65bf465a556b">status_publisher</a>status_publisher.publish(msg)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keyword">def </span>_test_aruco_detection(self) -&gt; bool:</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Test if ArUco detection service is available.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">return</span> self.aruco_detection_client.wait_for_service(timeout_sec=2.0)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keyword">def </span>_handle_follow_control(</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        self, request: FollowMeControl.Request, response: FollowMeControl.Response</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    ) -&gt; FollowMeControl.Response:</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Handle follow me control service requests.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        logger.info(</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="stringliteral">&quot;Follow me control request&quot;</span>,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            target_tag_id=request.target_tag_id,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            enable_following=request.enable_following,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            operator_id=request.operator_id</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        )</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">if</span> request.enable_following:</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="comment"># Start following</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            success = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acdd406741d4c6b26282f46a78683533e">start_following</a>start_following(</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                target_tag_id=request.target_tag_id,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                safety_distance=request.safety_distance,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                max_speed=request.max_speed,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                operator_id=request.operator_id</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            )</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            response.success = success</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            response.message = <span class="stringliteral">&quot;Follow me started&quot;</span> <span class="keywordflow">if</span> success <span class="keywordflow">else</span> <span class="stringliteral">&quot;Failed to start follow me&quot;</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment"># Stop following</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a8750f2895a93f084bcfe671e73a99438">stop_following</a>stop_following()</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            response.success = <span class="keyword">True</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            response.message = <span class="stringliteral">&quot;Follow me stopped&quot;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        response.is_following = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        response.current_target_tag = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id <span class="keywordflow">else</span> 0</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        response.current_distance = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">target_distance</a>target_distance</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            response.target_position = self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">target_position</a>target_position</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">return</span> response</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aeeab4972c7702f2934b8f23c6c22582f">  362</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aeeab4972c7702f2934b8f23c6c22582f">get_status</a>(self) -&gt; Dict[str, Any]:</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get current follow me status.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">return</span> {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="stringliteral">&quot;is_following&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">is_following</a>is_following,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="stringliteral">&quot;target_tag_id&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">target_tag_id</a>target_tag_id,</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="stringliteral">&quot;target_distance&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">target_distance</a>target_distance,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="stringliteral">&quot;target_angle&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">target_angle</a>target_angle,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="stringliteral">&quot;safety_distance&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">safety_distance</a>safety_distance,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="stringliteral">&quot;safety_violation&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">safety_violation</a>safety_violation,</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="stringliteral">&quot;current_speed&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">current_speed</a>current_speed,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="stringliteral">&quot;target_visible&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">target_visible</a>target_visible,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="stringliteral">&quot;operator_id&quot;</span>: self.<a class="code" href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">operator_id</a>operator_id,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html">autonomy_state_machine.follow_me_behavior.FollowMeBehavior</a></div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00024">follow_me_behavior.py:24</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a028f7435d51f42f949d1f0008ccba85a"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a028f7435d51f42f949d1f0008ccba85a">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.operator_id</a></div><div class="ttdeci">operator_id</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00046">follow_me_behavior.py:46</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a13d1a944a89f547d0f8bb411c4f37f3b"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a13d1a944a89f547d0f8bb411c4f37f3b">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.target_angle</a></div><div class="ttdeci">target_angle</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00051">follow_me_behavior.py:51</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a1a03ea3d43fea9c1524bdb0edf97378d"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1a03ea3d43fea9c1524bdb0edf97378d">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.max_speed</a></div><div class="ttdeci">max_speed</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00045">follow_me_behavior.py:45</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a1d95bd2752635a08e34c65bf465a556b"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a1d95bd2752635a08e34c65bf465a556b">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.status_publisher</a></div><div class="ttdeci">status_publisher</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00075">follow_me_behavior.py:75</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a34c24361ed5e575c7eb977b4a5a7ac25"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a34c24361ed5e575c7eb977b4a5a7ac25">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._detect_target_tag</a></div><div class="ttdeci">Optional[Tuple[Point, float, float]] _detect_target_tag(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00207">follow_me_behavior.py:207</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a40fc58836d77de1e0525345143595eba"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a40fc58836d77de1e0525345143595eba">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.target_distance</a></div><div class="ttdeci">target_distance</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00050">follow_me_behavior.py:50</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a5ab37fe25aaf2209a5bf717b1aa2bc8c"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a5ab37fe25aaf2209a5bf717b1aa2bc8c">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._publish_velocity</a></div><div class="ttdeci">None _publish_velocity(self, float linear_x, float linear_y, float angular_z)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00287">follow_me_behavior.py:287</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a6040bca0161bc5e1b9c5597a191778c7"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6040bca0161bc5e1b9c5597a191778c7">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._publish_status</a></div><div class="ttdeci">None _publish_status(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00295">follow_me_behavior.py:295</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a62fb804843d7fbd4b9580949e918c9e3"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a62fb804843d7fbd4b9580949e918c9e3">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.__init__</a></div><div class="ttdeci">def __init__(self, Node node)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00032">follow_me_behavior.py:32</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a6b8b6616c16faa8cc9579bd01e6d9e7b"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6b8b6616c16faa8cc9579bd01e6d9e7b">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.control_timer</a></div><div class="ttdeci">control_timer</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00089">follow_me_behavior.py:89</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a6c49135c12d2a82ce6cef279ef248251"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6c49135c12d2a82ce6cef279ef248251">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.safety_distance</a></div><div class="ttdeci">safety_distance</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00044">follow_me_behavior.py:44</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a6d6e3562bd958d91cb4d901cbfe93043"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a6d6e3562bd958d91cb4d901cbfe93043">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.last_detection_time</a></div><div class="ttdeci">last_detection_time</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00052">follow_me_behavior.py:52</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a729143929cecda95890756f97170216d"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a729143929cecda95890756f97170216d">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.target_tag_id</a></div><div class="ttdeci">target_tag_id</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00133">follow_me_behavior.py:133</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a787bb64f9d81160cca74bff352d6a232"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a787bb64f9d81160cca74bff352d6a232">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._follow_control_loop</a></div><div class="ttdeci">None _follow_control_loop(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00165">follow_me_behavior.py:165</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a871185943027627b25202623b368fba1"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a871185943027627b25202623b368fba1">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.status_timer</a></div><div class="ttdeci">status_timer</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00092">follow_me_behavior.py:92</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a8750f2895a93f084bcfe671e73a99438"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a8750f2895a93f084bcfe671e73a99438">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.stop_following</a></div><div class="ttdeci">None stop_following(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00149">follow_me_behavior.py:149</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a952a296e42b5fe32453c5b557c81060e"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a952a296e42b5fe32453c5b557c81060e">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.safety_violation</a></div><div class="ttdeci">safety_violation</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00056">follow_me_behavior.py:56</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_a9de4d5ff3d78f6412ec0bd3dffc072aa"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#a9de4d5ff3d78f6412ec0bd3dffc072aa">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._handle_follow_control</a></div><div class="ttdeci">FollowMeControl.Response _handle_follow_control(self, FollowMeControl.Request request, FollowMeControl.Response response)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00325">follow_me_behavior.py:327</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_aa2676148fe71bcf7112d1f0ed135f245"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aa2676148fe71bcf7112d1f0ed135f245">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.qos</a></div><div class="ttdeci">qos</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00060">follow_me_behavior.py:60</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_aaed3b408a7f7ea3e0f61f771132417c1"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aaed3b408a7f7ea3e0f61f771132417c1">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.target_position</a></div><div class="ttdeci">target_position</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00159">follow_me_behavior.py:159</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_ab6dc89be5ee4d0f4059d7692c51ce38c"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#ab6dc89be5ee4d0f4059d7692c51ce38c">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.cmd_vel_publisher</a></div><div class="ttdeci">cmd_vel_publisher</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00078">follow_me_behavior.py:78</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_abf65a1c807cb9031346cd147c7d17536"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#abf65a1c807cb9031346cd147c7d17536">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._test_aruco_detection</a></div><div class="ttdeci">bool _test_aruco_detection(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00321">follow_me_behavior.py:321</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_accfd84ff3ab8db4164126bf100e06116"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#accfd84ff3ab8db4164126bf100e06116">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.follow_control_service</a></div><div class="ttdeci">follow_control_service</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00083">follow_me_behavior.py:83</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_acd0dac2e27b640aad0f43042c64c0745"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acd0dac2e27b640aad0f43042c64c0745">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.node</a></div><div class="ttdeci">node</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00039">follow_me_behavior.py:39</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_acdd406741d4c6b26282f46a78683533e"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#acdd406741d4c6b26282f46a78683533e">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.start_following</a></div><div class="ttdeci">bool start_following(self, int target_tag_id, float safety_distance=2.0, float max_speed=1.0, str operator_id=&quot;unknown&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00096">follow_me_behavior.py:102</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_aee52dc21be0d95d6b5b84b5b2ec6e45f"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aee52dc21be0d95d6b5b84b5b2ec6e45f">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.current_speed</a></div><div class="ttdeci">current_speed</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00057">follow_me_behavior.py:57</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_aeeab4972c7702f2934b8f23c6c22582f"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aeeab4972c7702f2934b8f23c6c22582f">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.get_status</a></div><div class="ttdeci">Dict[str, Any] get_status(self)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00362">follow_me_behavior.py:362</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_aef95fccec19548be0aca51ffff86a4f8"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#aef95fccec19548be0aca51ffff86a4f8">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.target_visible</a></div><div class="ttdeci">target_visible</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00053">follow_me_behavior.py:53</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_af9eb93845dfe875e7df7e788ec472364"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#af9eb93845dfe875e7df7e788ec472364">autonomy_state_machine.follow_me_behavior.FollowMeBehavior.is_following</a></div><div class="ttdeci">is_following</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00042">follow_me_behavior.py:42</a></div></div>
<div class="ttc" id="aclassautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior_html_afb9d6741e38fce29341193c2a1ca4235"><div class="ttname"><a href="classautonomy__state__machine_1_1follow__me__behavior_1_1_follow_me_behavior.html#afb9d6741e38fce29341193c2a1ca4235">autonomy_state_machine.follow_me_behavior.FollowMeBehavior._calculate_movement</a></div><div class="ttdeci">Tuple[float, float] _calculate_movement(self, float distance, float angle)</div><div class="ttdef"><b>Definition:</b> <a href="follow__me__behavior_8py_source.html#l00253">follow_me_behavior.py:253</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 6 2025 00:13:50 for URC Machiato 2026 Autonomy by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
